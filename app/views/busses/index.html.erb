<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <!-- Change this if you want to allow scaling -->
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet"  href="stylesheets/jquery.mobile-1.0a4.1.min.css" />
    <link rel="stylesheet"  href="stylesheets/mobile.css" />
    <script src="javascripts/jquery.min.js"></script>
    <script src="javascripts/jquery.mobile-1.0a4.1.min.js"></script>       
    <script src="javascripts/mustache.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=true"> </script> 
    <script src="javascripts/geojson-to-google-maps.js"></script>  
    <script type="text/javascript">
      var busses = {}
      JSON.parse('<%= @busses.to_json.html_safe %>').map(function(bus) {
        busses[bus.properties.fleet] = bus;
      });
      $(function() {
        $('#map').live('pageshow', function (event, ui) {
          target = $(event.currentTarget).attr('fleet');
          showMap(busses[target], event.currentTarget);
        });
      })
    </script>
    <script src="javascripts/busmap.js" type="text/javascript"></script>
  </head>
  <body>
    <div data-role="page" data-theme="b" id="home"> 
      <div data-role="header">
        <h1>Bus Location</h1>
         <%= link_to "sign out", destroy_user_session_path, :"data-ajax"=>"false" %>
      </div>
      <div data-role="content"> 
        <ul data-role="listview" data-inset="true" data-theme="c" data-dividertheme="b"> 
    			<li data-role="list-divider">Busses</li>
    			<%- @busses.each do |bus| %>
      			<li>
      			  <a href="/busses/<%= bus[:properties]['fleet'] %>">
      			    <%= bus[:properties]['fleet'] %>
      			  </a>
      			</li> 
    			<%- end %>
  			</ul>
  		</div>
    </div>
  </body>
</html>
